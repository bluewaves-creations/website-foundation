---
import { getCollection } from "astro:content";
import Base from "../layouts/Base.astro";
import PromotedCard from "../components/PromotedCard.astro";
import BlogCard from "../components/BlogCard.astro";
import GalleryCard from "../components/GalleryCard.astro";
import TestimonialCard from "../components/TestimonialCard.astro";
import Button from "../components/Button.astro";

export const prerender = true;

const promoted = (await getCollection("promoted")).sort((a, b) => a.data.order - b.data.order);
const posts = (await getCollection("blog"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime())
  .slice(0, 3);
const galleryItems = (await getCollection("gallery"))
  .sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime())
  .slice(0, 6);
const testimonials = await getCollection("testimonials");
---

<Base title="Wave Artisans — Website Blueprint">
  <!-- Hero / Promoted -->
  <section class="mx-auto max-w-6xl px-4 pt-20 pb-16 sm:pt-28 sm:pb-20">
    <h1 class="text-4xl font-semibold leading-[1.1] tracking-tight text-gray-900 dark:text-gray-100 sm:text-5xl md:text-6xl">
      Website Blueprint
    </h1>
    <p class="mt-4 max-w-2xl text-lg sm:text-xl text-gray-600 dark:text-gray-400">
      A production-ready foundation for your next site. Astro 5, Tailwind CSS v4, and Cloudflare Workers — designed to be forked and made your own.
    </p>
    <div class="mt-12 grid gap-8 sm:grid-cols-2">
      {promoted.map((item) => (
        <PromotedCard
          title={item.data.title}
          description={item.data.description}
          image={item.data.image}
          link={item.data.link}
          linkText={item.data.linkText}
        />
      ))}
    </div>
  </section>

  <!-- Blog Highlights -->
  <section class="border-t border-gray-200 dark:border-gray-800">
    <div class="mx-auto max-w-6xl px-4 py-14 sm:py-20">
      <div class="flex items-center justify-between">
        <h2 class="text-2xl sm:text-3xl font-bold leading-tight text-gray-900 dark:text-gray-100">From the Blog</h2>
        <Button href="/blog" variant="ghost" size="sm">View all</Button>
      </div>
      <div class="mt-10 grid gap-x-8 gap-y-10 sm:grid-cols-2 lg:grid-cols-3">
        {posts.map((post) => (
          <BlogCard
            title={post.data.title}
            description={post.data.description}
            slug={post.id}
            publishedAt={post.data.publishedAt}
            author={post.data.author}
            image={post.data.image}
            tags={post.data.tags}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Gallery Preview -->
  <section class="border-t border-gray-200 dark:border-gray-800">
    <div class="mx-auto max-w-6xl px-4 py-14 sm:py-20">
      <div class="flex items-center justify-between">
        <h2 class="text-2xl sm:text-3xl font-bold leading-tight text-gray-900 dark:text-gray-100">Inspiration</h2>
        <Button href="/gallery" variant="ghost" size="sm">View all</Button>
      </div>
      <div class="mt-8 grid gap-3 grid-cols-2 lg:grid-cols-3">
        {galleryItems.map((item) => (
          <GalleryCard
            title={item.data.title}
            description={item.data.description}
            image={item.data.image}
            slug={item.id}
            category={item.data.category}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="border-t border-gray-200 dark:border-gray-800">
    <div class="mx-auto max-w-6xl px-4 py-14 sm:py-20">
      <h2 class="text-2xl sm:text-3xl font-bold leading-tight text-gray-900 dark:text-gray-100">What Developers Say</h2>
      <div class="mt-10 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {testimonials.map((t) => (
          <TestimonialCard
            author={t.data.author}
            role={t.data.role}
            company={t.data.company}
            avatar={t.data.avatar}
            rating={t.data.rating}
            body={t.body ?? ""}
          />
        ))}
      </div>
    </div>
  </section>
</Base>
